{% extends "lfc/base.html" %}
{% load i18n %}
{% load lfc_tags %}
{% load portlets_tags %}
{% load tagging_tags %}
{% load pagination_tags %}
{% load comments %}

{% block css %}
<link rel="stylesheet" href="{{ MEDIA_URL }}kidness_theme/fancybox/jquery.fancybox-1.3.4.css" type="text/css" media="screen" />
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}kidness_theme/css/jcarousel_kidness/skin.css">
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}kidness_theme/css/scrollable_part.css">
{% endblock %}
{% block javascript %}
	<script type="text/javascript" src="{{ MEDIA_URL }}kidness_theme/js/jquery.jcarousel.min.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}kidness_theme/fancybox/jquery.fancybox-1.3.4.pack.js"></script>
	
	<script type="text/javascript">
		// execute your scripts when DOM is ready. this is a good habit
		
		// JCarousel
		/**
		 * We use the initCallback callback
		 * to assign functionality to the controls
		 */
		
		function hideDescriptionText(){
			$("#toggled_text").hide(900);
			$("#toggled_teaser").show(900);
			$("#toggle_action").text("...");
		} 
		 
		// Ride the carousel...
		jQuery(document).ready(function() {
			function mycarousel_initCallback(carousel) {
			    jQuery('.jcarousel-control a').bind('click', function() {
			    	
			    	carousel.scroll(jQuery.jcarousel.intval($(this).attr('href').split('-')[1]));
			    	
			    	var partid = $(this).attr('href');
			    	$(".itemScroll").removeClass("selectedItem");
			    	$(".itemScroll").children('div').removeClass("selectedItem");
			    	$(partid).addClass("selectedItem");
			    	$(partid).children('div').addClass("selectedItem");
			    	
			        //carousel.scroll(jQuery.jcarousel.intval(jQuery(this).text()));
			        return false;
			    });
			
			    jQuery('.jcarousel-scroll select').bind('change', function() {
			        carousel.options.scroll = jQuery.jcarousel.intval(this.options[this.selectedIndex].value);
			        return false;
			    });
			
			    jQuery('#next').bind('click', function() {
			        carousel.next();
			        $(".itemScroll").removeClass("selectedItem");
			    	$(".itemScroll").children('div').removeClass("selectedItem");
			        return false;
			    });
			
			    jQuery('#prev').bind('click', function() {
			        carousel.prev();
			        $(".itemScroll").removeClass("selectedItem");
			    	$(".itemScroll").children('div').removeClass("selectedItem");
			        return false;
			    });
			};
		    jQuery("#mycarousel").jcarousel({
		        scroll: 3,
		        vertical: true,
		        initCallback: mycarousel_initCallback,
		        // This tells jCarousel NOT to autobuild prev/next buttons
		        buttonNextHTML: null,
		        buttonPrevHTML: null,
		        itemLastInCallback : function(object,li,idx,state){
		        	var carousel = jQuery('#mycarousel').data('jcarousel');
		        	if (state!="init"){
		        		hideDescriptionText();
		        		if (idx==carousel.size())
		        			$("#next").hide();
		        		else
		        			$("#next").show();
		        	}
		        },
		    	itemFirstInCallback : function(object,li,idx,state){
	        		if (state!="init"){
	        			hideDescriptionText();
	        			if (idx==1)
	        				$("#prev").hide();
	        			else
	        				$("#prev").show();
	        		}
	        	}
		    });
		    
		    $("#prev").hide();
		    
			$(".child_text").hide();
			$(".fancybox_inline").hide();
			
			$(".text_toggle_action").fancybox();
			$(".fancybox_action").fancybox();
			
			$(".itemScroll").bind("mouseover", function(){
				$(".itemScroll").removeClass("selectedItem");
		    	$(".itemScroll").children('div').removeClass("selectedItem");
		    	$(this).addClass("selectedItem");
		    	$(this).children('div').addClass("selectedItem");
			});
			$(".itemScroll").bind("mouseout", function(){
				$(".itemScroll").removeClass("selectedItem");
		    	$(".itemScroll").children('div').removeClass("selectedItem");
			});
			
			$(".scrollable_action").bind("click", function(){
				/*
				$("#toggled_text").hide(900);
				$("#toggled_teaser").show(900);
				$("#toggle_action").text("...");
				*/
				hideDescriptionText();
				return false;
			});
			
			$("#toggle_action").bind("click", function(){
				$("#toggled_teaser").toggle(900);
				$("#toggled_text").toggle(900);
				
				if( $(this).text()=="Свернуть"){
					$(this).text("...");
				}else{
					$(this).text("Свернуть");					
				}
				return false;
			});
		});
	</script>
{% endblock %}

{% block section %}carousel overview{% endblock %}
{% block content %}
    {% if lfc_context.display_title %}
        <h1 class="first-heading">{{ lfc_context.title }}</h1>
    {% endif %}
    
    {% if lfc_context.text %}
   		<div id="overview_teaser">
   			<div style="display:none" id="toggled_teaser">{{lfc_context.text|safe|truncatewords_html:10}}</div>
		   	<div id="toggled_text">
		   		{{lfc_context.text|safe}}
		   	</div>
		   	<a id="toggle_action" class="showOverviewText" href="#">Свернуть</a>
	   	        <span class="tlSH"></span>
                <span class="trSH"></span>
                <span class="blSH"></span>
                <span class="brSH"></span>
	   	<div class="clear"></div>
	   	</div>
   	{% endif %}
    
    {% ifequal lfc_context.content_type "scrollablecontainer" %}
   		<div>
           	{% include "scrollable_parts/scrollable_container.html" %}
           </div>
   	{% endifequal %}
   	
    {% for sub_object in sub_objects %}
	    {% ifnotequal sub_object.content_type "scrollablepart" %}
	    	{% ifequal sub_object.content_type "scrollablecontainer" %}
		   		<div>
		           	{% include "scrollable_parts/jcarousel_container.html" %}
		           </div>
		    {% else %}       
		        <div class="entry {% if forloop.last %}last{% endif %}">
		            <h2>
		                <a href="{{ sub_object.get_absolute_url }}">
		                    {{ sub_object.title }}
		                </a>    
		            </h2>
		            {% if sub_object.get_image %}
		                <img class="left"
		                     src="{{ sub_object.get_image.image.url_100x100 }}"
		                     alt="{{ sub_object.get_image.image.title }}"
		                     title="{{ sub_object.get_image.image.title }}" />
		            {% endif %}
		            <div>
		                {{ sub_object.description|safe }}
		            </div>
		        </div>
	        {% endifequal %}
	        <br clear="all" />
		{% endifnotequal %}
    {% endfor %}
    
{% endblock %}